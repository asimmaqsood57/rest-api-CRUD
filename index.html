<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>data</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We"
      crossorigin="anonymous"
    />
  </head>

  <script>
    const postData = () => {
      const name = document.getElementById("name").value;

      const email = document.getElementById("email").value;

      const age = document.getElementById("age").value;

      const intAge = parseInt(age);

      const phone = document.getElementById("phone").value;
      const intPhone = Number(phone);

      console.log(name, email, intAge, intPhone);

      const resp = fetch("http://localhost:3001/user", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          name: name,
          email: email,
          age: intAge,
          phone: intPhone,
        }),
      })
        .then((res) => {
          console.log(res);
        })
        .then((data) => {
          console.log(data);
        })
        .catch((err) => {
          console.log(err);
        });

      if (resp) {
        renderUsers();
      }
    };

    const fetchData = async () => {
      console.log("getting data");

      try {
        const respo = await fetch("http://localhost:3001/user", {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        });

        const data = await respo.json();
        console.log(data);

        return data;
      } catch (error) {
        console.log(error);
      }
    };

    const deleteData = async (id) => {
      if (window.confirm("Do you want to delete it?")) {
        const dataDeleted = await fetch(`http://localhost:3001/user/${id}`, {
          method: "delete",
          headers: {
            "Content-Type": "application/json",
          },
        });

        if (dataDeleted) {
          renderUsers();
        }
        console.log(dataDeleted);
      }
    };
    const updateData = async (editObj) => {
     
objuser = JSON.parse(decodeURIComponent(editObj));
console.log(objuser);



        console.log(editObj);

        let html = `  <div class="mb-3">
              <label for="exampleInputEmail1" class="form-label"
                >Email address</label
              >
              <input
                type="email"
                class="form-control"
                id="exampleInputEmail1"
                aria-describedby="emailHelp"
              />
              <div id="emailHelp" class="form-text">
                We'll never share your email with anyone else.
              </div>
            </div>
            <div class="mb-3">
              <label for="exampleInputPassword1" class="form-label"
                >Password</label
              >
              <input
                type="password"
                class="form-control"
                id="exampleInputPassword1"
              />
            </div>
            <div class="mb-3 form-check">
              <input
                type="checkbox"
                class="form-check-input"
                id="exampleCheck1"
              />
              <label class="form-check-label" for="exampleCheck1"
                >Check me out</label
              >
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>`;


          document.getElementById('edit').innerHTML = html;



    };
    async function renderUsers() {
      let users = await fetchData();
      let html = "";
      users.forEach((user) => {

        
        
        let htmlSegment = `    <tr>
          <td>${user.name}</td>
          <td>${user.email}</td>
          <td>${user.age} </td>
          <td><button type="button" onclick="updateData( ' ${encodeURIComponent(JSON.stringify(user))} '  )"  class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
  Edit
</button></td>
         <td><button onclick="deleteData('${user._id}')" class="btn btn-danger">Delete</button>
    </td>
          </tr>`;

        html += htmlSegment;
      });

      let container = document.getElementById("data");
      container.innerHTML = html;
    }

    renderUsers();

    // postData();
  </script>

  <body>
    <table class="table">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">email</th>
          <th scope="col">age</th>
          <th scope="col">Edit</th>
          <th scope="col">Delete</th>
        </tr>
      </thead>
      <tbody id="data"></tbody>
    </table>

    <div class="container">
      <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Name</label>
        <input
          type="text"
          class="form-control"
          id="name"
          aria-describedby="emailHelp"
        />
      </div>

      <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Email address</label>
        <input
          type="email"
          class="form-control"
          id="email"
          aria-describedby="emailHelp"
        />
      </div>

      <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Age</label>
        <input
          type="text"
          class="form-control"
          id="age"
          aria-describedby="emailHelp"
        />
      </div>

      <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Phone No.</label>
        <input
          type="text"
          class="form-control"
          id="phone"
          aria-describedby="emailHelp"
        />
      </div>

      <div class="mb-3 form-check">
        <input type="checkbox" class="form-check-input" id="exampleCheck1" />
        <label class="form-check-label" for="exampleCheck1">Check me out</label>
      </div>
      <button onclick="postData()" class="btn btn-primary">Submit</button>
    </div>

    <!-- modal -->

    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Edit Data</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body" id="edit">
          
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
    crossorigin="anonymous"
  ></script>
</html>
